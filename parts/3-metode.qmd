```{r hent-objekt-metode}
#| file: data/43-objekt.r
library(logger)
library(kableExtra)
log_info("Henter objekter til metode")
```

I denne del af opgaven vil jeg gennemgå metoden der vil blive brugt til at undersøge mit hovedspørgsmål.

## Data

Til dette projekt har jeg skabt et datasæt sammensat af valgstatistik for kommunalvalg fra Danmarks Statistiks valgdatabase [@danmarksstatistik2024] og optegnelser over vindmølleindstallationer i Danmark [@energistyrelsen2024].

Jeg begrænser de valg jeg undersøger til alle kommunalvalg efter 2007, hvor strukturreformen blev gennemført og ændrede strukturen i kommunerne [@kommunalreformen2007]. Der blev antallet af kommuner også ændret.

Af data fra @energistyrelsen2024 over opsatte vindmøller siden 14.12.1977 udvælger jeg de vindmøller der er opsat tidligst `r 365 * 4` dage før kommunalvalget i 2009 (som er det første valg efter strukturreformen). Heraf udvælges vindmølleinstallationer i valgperioderne fra kommunalvalg fra 2009 til 2021. Disse placeres i radius af et valgsted ved hjælp af afstemingssted-API fra @apidawa2024. Det giver samlet et datasæt med `r antal_obs_samlet` observationer over valgsteder gennem tiden. I alt `r n_distinct(analyse_data$valgsted_id)` unikke valgsteder er medtaget i mit endelige datasæt.

For en oversigt over de danske borgmestre gennem tiden har jeg sammensat @kjaer2018 og @kommunerneslandsforening2023, der udgør grundlaget for at definere hvilket parti der er borgmesterparti.

Det giver en datastruktur der ligner den i nedenstående @tbl-datastruktur-id og @tbl-datastruktur-vars, der viser hhv. identifikatorvariable og analysevariable for hver observation .

```{r}
#| label: tbl-datastruktur-id
#| tbl-cap: "Datastruktur for identifikator i datasæt"
#| output: true
datastruktur_id <- datastruktur %>%
    select(valgsted_id, valg, Parti, blue_blok) %>%
    rename("Valgsted" = valgsted_id,
                "Valg" = valg,
                "Parti" = Parti,
                "Blå blok" = blue_blok)

kbl(datastruktur_id)
```

```{r}
#| label: tbl-datastruktur-vars
#| tbl-cap: "Datastruktur for analysevariable"
#| output: true
datastruktur_vars <- datastruktur %>%
    select(!c(valgsted_id, valg, Parti, blue_blok)) %>%
    rename("Stemmer til borgmesterens parti" = borgmester_stemmer,
                "% Stemmer til borgmesterens parti" = borgmester_stemmer_pct,
                "Vindmølle tilsluttet" = tilslutning_aar_valg)

kbl(datastruktur_vars)
```

#| file: data/30-plots.r
#| error: false
#| cache: true
#| warning: false
#| output: false

```

::: {#fig-vindmølle-2 fig-cap="" fig-cap-location="top"}

![](output/billeder/valgsteder-map-1.png)

\raggedright

Note: Stemmesteder fordelt på valgår. Hvert stemmested fremgår kun en gang.

Kilde: Egen tilvirkning, @apidawa2024 og @danmarksstatistik2024

\centering

Afstemningssteder der har fået vindmølle i valgperiode

:::