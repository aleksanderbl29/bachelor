```{r hent-objekt-metode}
#| file: data/43-objekt.r
library(logger)
library(kableExtra)
log_info("Henter objekter til metode")
```

I denne del af opgaven vil jeg gennemgå metoden der vil blive brugt til at undersøge mit hovedspørgsmål.

## Data

Til dette projekt har jeg skabt et datasæt sammensat af valgstatistik for kommunalvalg fra Danmarks Statistiks valgdatabase [@danmarksstatistik2024] og optegnelser over vindmølleindstallationer i Danmark [@energistyrelsen2024].

Jeg begrænser de valg jeg undersøger til alle kommunalvalg efter 2007, hvor strukturreformen blev gennemført og ændrede strukturen i kommunerne [@kommunalreformen2007]. Der blev antallet af kommuner også ændret.

Af data fra @energistyrelsen2024 over opsatte vindmøller siden 14.12.1977 udvælger jeg de vindmøller der er opsat tidligst `r 365 * 4` dage før kommunalvalget i 2009 (som er det første valg efter strukturreformen). Heraf udvælges vindmølleinstallationer i valgperioderne fra kommunalvalg fra 2009 til 2021. Disse placeres i radius af et valgsted ved hjælp af afstemingssted-API fra @apidawa2024. Det giver samlet et datasæt med `r antal_obs_samlet` observationer over valgsteder gennem tiden. I alt `r n_distinct(analyse_data$valgsted_id)` unikke valgsteder er medtaget i mit endelige datasæt.

For en oversigt over de danske borgmestre gennem tiden har jeg sammensat @kjaer2018 og @kommunerneslandsforening2023, der udgør grundlaget for at definere hvilket parti der er borgmesterparti.

Det giver en datastruktur der ligner den i nedenstående @tbl-datastruktur-id og @tbl-datastruktur-vars, der viser hhv. identifikatorvariable og analysevariable for hver observation .

```{r}
#| label: tbl-datastruktur-id
#| tbl-cap: "Datastruktur for identifikator i datasæt"
#| output: true
datastruktur_id <- datastruktur %>%
    select(valgsted_id, valg, Parti, blue_blok) %>%
    rename("Valgsted" = valgsted_id,
                "Valg" = valg,
                "Parti" = Parti,
                "Blå blok" = blue_blok)

kbl(datastruktur_id)
```

```{r}
#| label: tbl-datastruktur-vars
#| tbl-cap: "Datastruktur for analysevariable"
#| output: true
datastruktur_vars <- datastruktur %>%
    select(!c(valgsted_id, valg, Parti, blue_blok)) %>%
    rename("Stemmer til borgmesterens parti" = borgmester_stemmer,
                "% Stemmer til borgmesterens parti" = borgmester_stemmer_pct,
                "Vindmølle tilsluttet" = tilslutning_aar_valg)

kbl(datastruktur_vars)
```

## Model

I dette afsnit vil jeg gennemgå de modeller jeg har opstillet for at undersøge mit spørgsmål. Jeg kommer ind på overvejelser omkring min analyse, herunder modellering og valg af kontrolvariable.

### Modelspecifikation

For at estimere effekten af en nyopsat vindmølle vil jeg benytte mig af en række modeller. Resultaterne af disse vil jeg sammenligne for at kvalificere estimatet. Derudover vil jeg undersøge et udvalg af modellerne med en Goodman-Bacon dekomposition (HENVISNING) [@goodman-bacon2021]

Den grundlæggende model er sammensat som det ses i @eq-model-1. Jeg tager udgangspunkt i en simpel fixed-effects model, som kan ses i @eq-model-1

$$
    Y_{it} = \beta_i + \beta_{1}D_{it} + \epsilon_{it}
$$ {#eq-model-1}

Hvor $Y_{it}$ er borgmesterpartiets stemmeandel for valgsted $i$ ved valg $t$. $\beta_i$ er stemmeandel for valgsted $i$, hvor der ikke er opsat en vindmølle og $\beta_{1}$ er ændringen i stemmeandel, når $D\neq0$. $D_{it}$ indikerer om en vindmølle er opsat i nærheden af valgsted $i$ i perioden fra $t-1$ til $t$ og $\epsilon_{it}$ der er fejlledet.

For at tage højde for forskelle mellem valgsteder tilføjer jeg en dummy for valgstedet. Derudover tilføjer jeg en dummy for valgåret for at tage højde for generelle vælgerbevægelser, der sker på tværs af valgsteder. De udgør mine fixed effects, og det giver os den model der kan ses i @eq-model-2.

$$
    Y_{it} = \beta_i + \beta_{1}D_{it} + \alpha_i + \delta_t + \epsilon_{it}
$$ {#eq-model-2}

I @eq-model-2 er $\alpha_i$ vores fixed effect for valgsted $i$ og $\delta_t$ er vores fixed effect for valgår $t$.
Udover den grundlæggende model vil jeg undersøge mine forventninger til parti-forskelle af treatmenteffekten ved modellerne der kan ses i @eq-model-3, hvor der inkluderes et interaktionsled.

$$
    Y_{it} = \beta_i + \beta_{1}D_{it}Parti_{kt} + \alpha_i + \delta_t + \epsilon_{it}
$$ {#eq-model-3}
$$
    Y_{it} = \beta_i + \beta_{1}D_{it}Blok_{kt} + \alpha_i + \delta_t + \epsilon_{it}
$$ {#eq-model-4}

I @eq-model-3 er der nu tilføjet $Parti$ der indikerer det parti der er borgmester i valgsted $i$'s kommune $k$ på valgtidspunkt $t$. Tilsvarende undersøger jeg også modellen i @eq-model-4, hvor der er tilføjet en indikator for $Blok$, der har værdien $0$ for et borgmesterparti fra rød blok og værdien $1$ for et borgmesterparti fra blå blok.
#| file: data/30-plots.r
#| error: false
#| cache: true
#| warning: false
#| output: false

```

::: {#fig-vindmølle-2 fig-cap="" fig-cap-location="top"}

![](output/billeder/valgsteder-map-1.png)

\raggedright

Note: Stemmesteder fordelt på valgår. Hvert stemmested fremgår kun en gang.

Kilde: Egen tilvirkning, @apidawa2024 og @danmarksstatistik2024

\centering

Afstemningssteder der har fået vindmølle i valgperiode

:::