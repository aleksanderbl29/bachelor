```{r hent-objekt-metode}
#| file: data/43-objekt.r
library(logger)
library(kableExtra)
log_info("Henter objekter til metode")
```

I denne del af opgaven vil jeg gennemgå metoden der vil blive brugt til at undersøge mit hovedspørgsmål.

## Data

Til dette projekt har jeg skabt et datasæt sammensat af valgstatistik for kommunalvalg fra Danmarks Statistiks valgdatabase [@danmarksstatistik2024] og optegnelser over vindmølleindstallationer i Danmark [@energistyrelsen2024].

Jeg begrænser de valg jeg undersøger til alle kommunalvalg efter 2007, hvor strukturreformen blev gennemført og ændrede strukturen i kommunerne [@kommunalreformen2007]. Der blev antallet af kommuner også ændret.

Af data fra @energistyrelsen2024 over opsatte vindmøller siden 14.12.1977 udvælger jeg de vindmøller der er opsat tidligst `r 365 * 4` dage før kommunalvalget i 2009 (som er det første valg efter strukturreformen). Heraf udvælges vindmølleinstallationer i valgperioderne fra kommunalvalg fra 2009 til 2021. Disse placeres i radius af et valgsted ved hjælp af afstemingssted-API fra @apidawa2024. Det giver samlet et datasæt med `r antal_obs_samlet` observationer over valgsteder gennem tiden. I alt `r n_distinct(analyse_data$valgsted_id)` unikke valgsteder er medtaget i mit endelige datasæt.

For en oversigt over de danske borgmestre gennem tiden har jeg sammensat @kjaer2018 og @kommunerneslandsforening2023, der udgør grundlaget for at definere hvilket parti der er borgmesterparti.

Det giver en datastruktur der ligner den i nedenstående @tbl-datastruktur-id og @tbl-datastruktur-vars, der viser hhv. identifikatorvariable og analysevariable for hver observation .

```{r}
#| label: tbl-datastruktur-id
#| tbl-cap: "Datastruktur for identifikator i datasæt"
#| output: true
datastruktur_id <- datastruktur %>%
    select(valgsted_id, valg, Parti, blue_blok) %>%
    rename("Valgsted" = valgsted_id,
                "Valg" = valg,
                "Parti" = Parti,
                "Blå blok" = blue_blok)

kbl(datastruktur_id)
```

```{r}
#| label: tbl-datastruktur-vars
#| tbl-cap: "Datastruktur for analysevariable"
#| output: true
datastruktur_vars <- datastruktur %>%
    select(!c(valgsted_id, valg, Parti, blue_blok)) %>%
    rename("Stemmer til borgmesterens parti" = borgmester_stemmer,
                "% Stemmer til borgmesterens parti" = borgmester_stemmer_pct,
                "Vindmølle tilsluttet" = tilslutning_aar_valg)

kbl(datastruktur_vars)
```

## Model

I dette afsnit vil jeg gennemgå de modeller jeg har opstillet for at undersøge mit spørgsmål. Jeg kommer ind på overvejelser omkring min analyse, herunder modellering og valg af kontrolvariable.

### Modelspecifikation

For at estimere effekten af en nyopsat vindmølle vil jeg benytte mig af en række modeller. Resultaterne af disse vil jeg sammenligne for at kvalificere estimatet. Derudover vil jeg undersøge et udvalg af modellerne med en Goodman-Bacon dekomposition (HENVISNING) [@goodman-bacon2021]

Den grundlæggende model er sammensat som det ses i @eq-model-1. Jeg tager udgangspunkt i en simpel fixed-effects model, som kan ses i @eq-model-1

$$
    Y_{it} = \beta_i + \beta_{1}D_{it} + \epsilon_{it}
$$ {#eq-model-1}

Hvor $Y_{it}$ er borgmesterpartiets stemmeandel for valgsted $i$ ved valg $t$. $\beta_i$ er stemmeandel for valgsted $i$, hvor der ikke er opsat en vindmølle og $\beta_{1}$ er ændringen i stemmeandel, når $D\neq0$. $D_{it}$ indikerer om en vindmølle er opsat i nærheden af valgsted $i$ i perioden fra $t-1$ til $t$ og $\epsilon_{it}$ der er fejlledet.

For at tage højde for forskelle mellem valgsteder tilføjer jeg en dummy for valgstedet. Derudover tilføjer jeg en dummy for valgåret for at tage højde for generelle vælgerbevægelser, der sker på tværs af valgsteder. De udgør mine fixed effects, og det giver os den model der kan ses i @eq-model-2.

$$
    Y_{it} = \beta_i + \beta_{1}D_{it} + \alpha_i + \delta_t + \epsilon_{it}
$$ {#eq-model-2}

I @eq-model-2 er $\alpha_i$ vores fixed effect for valgsted $i$ og $\delta_t$ er vores fixed effect for valgår $t$.
Udover den grundlæggende model vil jeg undersøge mine forventninger til parti-forskelle af treatmenteffekten ved modellerne der kan ses i @eq-model-3, hvor der inkluderes et interaktionsled.

$$
    Y_{it} = \beta_i + \beta_{1}D_{it}Parti_{kt} + \alpha_i + \delta_t + \epsilon_{it}
$$ {#eq-model-3}
$$
    Y_{it} = \beta_i + \beta_{1}D_{it}Blok_{kt} + \alpha_i + \delta_t + \epsilon_{it}
$$ {#eq-model-4}

I @eq-model-3 er der nu tilføjet $Parti$ der indikerer det parti der er borgmester i valgsted $i$'s kommune $k$ på valgtidspunkt $t$. Tilsvarende undersøger jeg også modellen i @eq-model-4, hvor der er tilføjet en indikator for $Blok$, der har værdien $0$ for et borgmesterparti fra rød blok og værdien $1$ for et borgmesterparti fra blå blok.

## Fixed effects

Jeg har valgt at gå med en tovejs fixed effects model for at imødekomme det udeladt variabel bias [@stock2020: 367], der helt uundgåeligt vil forekomme med det datasæt jeg har produceret.

Mine modeller estimeres ved hjælp af `feols` fra @berge2018 og @berge2024.

### Antagelser under fixed effects

For at vi kan stole på resultaterne fra en fixed-effects model er det vigtigt at en række antagelser er opfyldt. I dette afsnit vil jeg gennemgå antagelserne og evaluere tilstedeværelsen for mine data og for mine modeller.

#### Parallelle trends

Antagelsen om parallelle trends siger at der i fraværet af treatment skal være samme udvikling på den afhængige variabel for de treatede enheder såvel som de ikke-treatede [@dechaisemartin2023: 2]. Denne antagelse er videreført fra antagelsen om parallelle trends der bruges ved en traditionel differences-in-differences tilgang, hvor vi i denne fixed effects model også skal vurdere de aldrig-treatede enheder også opfylder antagelsen om parallele trends [@sun2021: 7].


### Fixed Effects udfordringer

Den fixed effects model jeg bruger er i bund og grund en udvidet differences-in-differences model der har flere tidsperioder (end to) og flere $i$ eller enheder (valgsteder). Da et estimat fra sådan en tovejs fixed effects model (som den jeg bruger) i bund og grund er en differences-in-differneces der sammenligner enheder før og efter treatment, på tværs af enhederne [@huntington-klein2022: 389-297;@goodman-bacon2021]. @goodman-bacon2021 har bevist at denne type tovejs fixed effects faktisk sammenligner alle mulige diferences-in-differences sammenhænge på tværs af tid; det er et rigtigt problem, hvis treatment indtræffer på forskellige tidspunkter.

For at forsøge at imødekomme nogle af de udfordringer jeg har beskrevet ovenfor vil jeg gøre følgende: 1) centrere hvert valgsteds tidslinje omkring dets treatmenttidspunkt (modsat kalendertid) [@huntington-klein2022: 460; @sun2021] og, 2) interagere treatmenttidspunktet med indikatoren for valgstedet [@sun2021: 22].

Ved at centrere om treatmenttidspunktet sikrer jeg at der ikke bruges enheder der har modtaget treatment i en tidligere periode som sammenligning (i kontrolgruppen) for med de nyligt treatede [@huntington-klein2022: 460]. Derudover sikrer jeg ved at interagere treatmenttidspunktet med indikatoren for valgstedet, at der ikke sammenlignes med treatede enheder, fordi der fjernes en del af sammenligningerne [@huntington-klein2022: 460]. Jeg risikerer dog, at den fundne effekt bliver mindre, men om ikke andet mere pålidelig.

## Generaliserbarhed

I dette afsnit vil jeg gennemgå mine overvejelser omkring dette studies generaliserbarhed. For

### Fordeling af vindmøller

For at vurdere den generelle eksterne validitet af mit design vil jeg se på, hvordan vindmøllerne er fordelt på flere parametre. Her vil jeg kortlægge den geografiske fordeling og fordelingen på borgmesterpartier.

```{r 30-plots}
#| file: data/30-plots.r
#| error: false
#| cache: true
#| warning: false
#| output: false

```

#### Den geografiske fordeling
For at undersøge, hvordan vindmøllerne er geografisk fordelt har jeg produceret @fig-vindmølle-geo

::: {#fig-vindmølle-geo}

![](output/billeder/valgsteder-map-1.png)

\raggedright
\footnotesize
\setstretch{1}
Note: Stemmesteder fordelt på valgår. Hvert stemmested fremgår kun en gang.

Kilde: Egen tilvirkning på baggrund af kortdata fra @apidawa2024, valgstatistik fra @danmarksstatistik2024 og vindmølledata fra @energistyrelsen2024.

Afstemningssteder der har fået vindmølle i valgperiode

:::



#### Fordeling på partier

::: {#fig-vindmølle-parti}

```{r 33-stemme-plots}
#| file: data/33-stemme-plots.r
#| cache: true
```
```{r valg-parti-kort}
#| fig-width: 10
#| fig-height: 8
#| output: true
valg_parti_kort
```

\raggedright
\footnotesize
\setstretch{1}
Note: Vindmøller fordelt på parti. Hvert valg har sit eget kort. De sorte prikker indikerer en ny vindmølle. Farven indikerer den siddende borgmesters parti ved hvert valg. \newline
Kilde: Egen tilvirkning på baggrund af kortdata fra @apidawa2024, valgstatistik fra @danmarksstatistik2024 og vindmølledata fra @energistyrelsen2024.

Kort over borgmestre gennem undersøgelsens valg

:::

Som vi kan se af @fig-vindmølle-parti er der en overvægt af vindmøller opsat i kommuner, der har Venstre-borgmestre. Det underbygges yderligere af @tbl-vindmølle-parti, hvor vi kan se, at `r venstre_vind_pct` af vindmøllerne er placeret i Venstre-kommuner.

::: {#fig-år-valgsted-kort}

```{r}
#| output: true
#| fig-width: 10
#| fig-height: 8
parti_aar_valgsted_kort
```

\raggedright
\footnotesize
\setstretch{1}
Note: Vindmøller fordelt på valgsteder. Hvert valg har sit eget kort. Farvede valgsteder har fået vindmølle. Farven indikerer den siddende borgmesters parti ved hvert valg. \newline
Kilde: Egen tilvirkning på baggrund af kortdata fra @apidawa2024, valgstatistik fra @danmarksstatistik2024 og vindmølledata fra @energistyrelsen2024.

Kort over valgsteders partiorientering ved vindmølle-valg

:::

I @tbl-vindmølle-parti kan vi se, at der er en overvægt at valgsteder i Venstre-kommuner, der har fået vindmøller mellem valg. En del af dette kan forklares med Venstre-kommunernes geografiske placering som set i @fig-vindmølle-geo og @fig-vindmølle-parti, der er mod kysterne og hvor der er meget vind. Der er dog stadig en del vindmøller i socialdemokratiske kommuner, hvorfor jeg ikke vurderer det som et seriøst problem.

```{r}
#| label: tbl-vindmølle-parti
#| tbl-cap: "Fordeling af vindmøller på partier"
#| output: asis
tbl_vindmølle_parti
```

### Sortering i data

For alle regressioner, der inkluderer blok-inddeling er borgmestre fra lokallister frasorteret. Det er gjort for at muliggøre den traditionelle blokinddeling. Det resulterer i at vi mister `r analyse_data %>% filter(Parti == "Lokalliste") %>% distinct(kommune_valg_id) %>% nrow` valgsted/valg observationer